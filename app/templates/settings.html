{% extends "base.html" %}

{% block content %}
  <div class="page-header">
    <div>
      <h1>Settings</h1>
      <div class="muted">Controls polling + suggestion creation limits.</div>
    </div>
    <div class="actions">
      <form method="post" action="/prompts/reload">
        <button type="submit" class="button">Reload prompts</button>
      </form>
    </div>
  </div>

  <div class="card">
    <div class="label">OpenAI models</div>
    <div class="mono">Summary: {{ openai_summary_model }}</div>
    <div class="mono">Reply: {{ openai_reply_model }}</div>
    <div class="muted">Set <code>OPENAI_SUMMARY_MODEL</code> and <code>OPENAI_MODEL</code> in <code>.env</code>.</div>
  </div>

  <form method="post" action="/settings/save" class="form">
    <div class="form-row">
      <label class="label" for="k_messages">K (messages to fetch per chat)</label>
      <input class="input" id="k_messages" name="k_messages" type="number" min="1" max="100" value="{{ settings.k_messages }}" />
    </div>

    <div class="form-row">
      <label class="label" for="n_minutes">N (poll interval in minutes)</label>
      <input class="input" id="n_minutes" name="n_minutes" type="number" min="1" max="1440" value="{{ settings.n_minutes }}" />
    </div>

    <div class="form-row">
      <label class="label" for="max_suggestions_per_chat">Max pending suggestions per chat</label>
      <input class="input" id="max_suggestions_per_chat" name="max_suggestions_per_chat" type="number" min="1" max="10" value="{{ settings.max_suggestions_per_chat }}" />
    </div>

    <div class="form-row">
      <label class="label" for="cooldown_minutes">Cooldown (minutes, 0 disables)</label>
      <input class="input" id="cooldown_minutes" name="cooldown_minutes" type="number" min="0" max="1440" value="{{ settings.cooldown_minutes }}" />
      <div class="muted">If set, a chat wonâ€™t get a new suggestion until cooldown passes.</div>
    </div>

    <div class="actions">
      <button type="submit" class="button button--primary">Save</button>
    </div>
  </form>

  <div class="card">
    <div class="page-header">
      <div>
        <div class="label">Prompts</div>
        <div class="muted">Edit and save prompts here (writes JSON in <code>./prompts</code> and hot-reloads).</div>
      </div>
      <form method="post" action="/prompts/reload">
        <button type="submit" class="button">Reload all</button>
      </form>
    </div>

    {% if prompts and prompts|length > 0 %}
      <div class="cards">
        {% for p in prompts %}
          <div class="card">
            <div class="card__header">
              <div class="card__title">Prompt: {{ p.name }}</div>
              <div class="card__meta">
                <span class="pill">{{ p.role }}</span>
              </div>
            </div>

            <form method="post" action="/prompts/update" class="form">
              <input type="hidden" name="name" value="{{ p.name }}" />

              <div class="form-row">
                <label class="label" for="role-{{ p.name }}">Role</label>
                <select class="input" id="role-{{ p.name }}" name="role">
                  <option value="system" {% if p.role == 'system' %}selected{% endif %}>system</option>
                  <option value="user" {% if p.role == 'user' %}selected{% endif %}>user</option>
                </select>
              </div>

              <div class="form-row">
                <label class="label" for="content-{{ p.name }}">Content</label>
                <textarea class="input input--textarea" id="content-{{ p.name }}" name="content" rows="10">{{ p.content }}</textarea>
              </div>

              <div class="actions">
                <button type="submit" class="button button--primary">Save & reload</button>
              </div>
            </form>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="muted">(no prompts loaded)</div>
    {% endif %}
  </div>
{% endblock %}


